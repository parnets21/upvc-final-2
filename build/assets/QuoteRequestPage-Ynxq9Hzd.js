import{c as D,u as F,r as u,a as v,d as g,y as c,j as e,e as l}from"./index-BJNj8_gr.js";import{d as Q,i as $,s as y,G,v as L,u as j,N as O,O as W}from"./index-DLTgG_l3.js";import{B as N}from"./BuyerBottomNav-CEiaXiD3.js";const J=()=>{const{buyerToken:x}=D(),p=F(),[P,b]=u.useState(!0),[S,q]=u.useState(!1),[m,z]=u.useState([]),[C,B]=u.useState([]),[f,w]=u.useState(null),[M,T]=u.useState(!1),[s,A]=u.useState({name:"",contact:"",whatsapp:"",email:"",projectName:"",projectAddress:"",projectArea:"",pincode:"",gmapLocation:"",projectStage:"",timeline:""});u.useEffect(()=>{R()},[]);const R=async()=>{try{b(!0);let t=[];const a=await v.get(g("api/quotes"),{headers:{Authorization:`Bearer ${x}`}});if(a.data.success){if(t=(a.data.quotes||[]).filter(n=>!n.isGenerated),z(t),t.length===0){c.error("Please add products to your cart first"),setTimeout(()=>p("/buyer/buy-now"),2e3);return}const o=t.reduce((n,h)=>{const _=h.sqft||h.height*h.width;return n+_*h.quantity},0);A(n=>({...n,totalSqft:o.toFixed(2)}))}const r=await v.get(g("api/categories"));if(r.data&&(B(r.data),r.data.length>0&&t.length>0)){const d=r.data[0];w(d)}}catch(t){console.error("Error fetching data:",t),c.error("Failed to load data")}finally{b(!1)}},i=(t,a)=>{A(r=>({...r,[t]:a}))},k=()=>{const t=["name","contact","email","projectName","projectAddress","projectArea","pincode","projectStage","timeline"];for(const r of t)if(!s[r]||s[r].trim()==="")return c.error(`Please fill in the ${r.replace(/([A-Z])/g," $1").toLowerCase()} field`),!1;return m.length===0?(c.error("Please add at least one product to your quote"),!1):f?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)?s.contact.length!==10?(c.error("Please enter a valid 10-digit contact number"),!1):!0:(c.error("Please enter a valid email address"),!1):(c.error("Please select a category"),!1)},E=async t=>{if(t.preventDefault(),!!k()){if(!x){c.error("Please login to submit your request"),p("/buyer/login");return}try{q(!0);const a=m.reduce((o,n)=>{const h=n.sqft||n.height*n.width;return o+h*n.quantity},0),r={quotes:m.map(o=>({productType:o.productType,product:o.product?._id||o.product,color:o.color,installationLocation:o.installationLocation,height:o.height,width:o.width,quantity:o.quantity,remark:o.remark||"",sqft:o.sqft||o.height*o.width,isGenerated:!0,_id:o._id})),contactInfo:{name:s.name,contactNumber:s.contact,whatsappNumber:s.whatsapp||s.contact,email:s.email},projectInfo:{name:s.projectName,address:s.projectAddress,area:s.projectArea,pincode:s.pincode,googleMapLink:s.gmapLocation,stage:s.projectStage,timeline:s.timeline},categoryId:f._id};console.log("=== Submitting Lead ==="),console.log("Lead Data:",JSON.stringify(r,null,2)),console.log("API Endpoint:",g("api/seller/lead"));const d=await v.post(g("api/seller/lead"),r,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}});console.log("Lead Creation Response:",d.data),d.data.success&&(console.log("✅ Lead created successfully!"),console.log("Lead ID:",d.data.lead?._id),console.log("Lead Status:",d.data.lead?.status),console.log("Available Slots:",d.data.lead?.availableSlots),T(!0),c.success("Lead submitted successfully!"),setTimeout(()=>{p("/buyer/active-leads")},2e3))}catch(a){console.error("Error creating lead:",a),c.error(a.response?.data?.message||"Failed to submit lead. Please try again.")}finally{q(!1)}}};if(P)return e.jsxs("div",{className:"quote-request-container",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx(l,{children:"Loading..."})]}),e.jsx(N,{})]});if(M)return e.jsxs("div",{className:"quote-request-container",children:[e.jsxs("div",{className:"success-container",children:[e.jsx(Q,{size:80,color:"#22c55e"}),e.jsx(l,{weight:"Bold",className:"success-title",children:"Lead Submitted Successfully!"}),e.jsx(l,{className:"success-message",children:"Your request has been submitted. Sellers will contact you soon."})]}),e.jsx(N,{})]});const I=m.reduce((t,a)=>{const r=a.sqft||a.height*a.width;return t+r*a.quantity},0);return e.jsxs("div",{className:"quote-request-container",children:[e.jsxs("div",{className:"quote-request-header",children:[e.jsx("button",{onClick:()=>p(-1),className:"back-button",children:e.jsx($,{size:24})}),e.jsx(l,{weight:"Bold",className:"page-title",children:"Submit Quote Request"})]}),e.jsxs("div",{className:"quote-request-content",children:[e.jsxs("div",{className:"quotes-summary-card",children:[e.jsxs(l,{weight:"Bold",className:"section-title",children:["Your Selected Products (",m.length,")"]}),e.jsx("div",{className:"quotes-list",children:m.map((t,a)=>e.jsxs("div",{className:"quote-item",children:[e.jsx(l,{className:"quote-product",children:t.product?.title||t.productType}),e.jsxs("div",{className:"quote-details",children:[e.jsxs(l,{className:"quote-detail",children:["Color: ",t.color," | Size: ",t.width,"ft × ",t.height,"ft | Qty: ",t.quantity]}),e.jsxs(l,{className:"quote-sqft",children:[(t.sqft||t.height*t.width)*t.quantity," sq ft"]})]})]},a))}),e.jsx("div",{className:"total-sqft",children:e.jsxs(l,{weight:"Bold",children:["Total Area: ",I.toFixed(2)," sq ft"]})})]}),e.jsxs("form",{onSubmit:E,className:"quote-request-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx(l,{weight:"Bold",className:"section-title",children:"Contact Information"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(y,{size:18})," Full Name *"]}),e.jsx("input",{type:"text",value:s.name,onChange:t=>i("name",t.target.value),placeholder:"Enter your full name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(y,{size:18})," Contact Number *"]}),e.jsx("input",{type:"tel",value:s.contact,onChange:t=>i("contact",t.target.value),placeholder:"10-digit mobile number",maxLength:"10",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(y,{size:18})," WhatsApp Number"]}),e.jsx("input",{type:"tel",value:s.whatsapp,onChange:t=>i("whatsapp",t.target.value),placeholder:"10-digit WhatsApp number (optional)",maxLength:"10"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(G,{size:18})," Email Address *"]}),e.jsx("input",{type:"email",value:s.email,onChange:t=>i("email",t.target.value),placeholder:"your.email@example.com",required:!0})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx(l,{weight:"Bold",className:"section-title",children:"Project Information"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(L,{size:18})," Project Name *"]}),e.jsx("input",{type:"text",value:s.projectName,onChange:t=>i("projectName",t.target.value),placeholder:"e.g., My Dream Home",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(j,{size:18})," Project Address *"]}),e.jsx("textarea",{value:s.projectAddress,onChange:t=>i("projectAddress",t.target.value),placeholder:"Complete address of your project",rows:"3",required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(j,{size:18})," Area *"]}),e.jsx("input",{type:"text",value:s.projectArea,onChange:t=>i("projectArea",t.target.value),placeholder:"e.g., Whitefield",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(j,{size:18})," Pincode *"]}),e.jsx("input",{type:"text",value:s.pincode,onChange:t=>i("pincode",t.target.value),placeholder:"6-digit pincode",maxLength:"6",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(j,{size:18})," Google Map Link"]}),e.jsx("input",{type:"url",value:s.gmapLocation,onChange:t=>i("gmapLocation",t.target.value),placeholder:"https://maps.google.com/..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(O,{size:18})," Project Stage *"]}),e.jsxs("select",{value:s.projectStage,onChange:t=>i("projectStage",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select stage"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"under construction",children:"Under Construction"}),e.jsx("option",{value:"ready to move",children:"Ready to Move"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(W,{size:18})," Timeline *"]}),e.jsxs("select",{value:s.timeline,onChange:t=>i("timeline",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select timeline"}),e.jsx("option",{value:"0-30 days",children:"0-30 days"}),e.jsx("option",{value:"31-60 days",children:"31-60 days"}),e.jsx("option",{value:"above 60 days",children:"Above 60 days"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(L,{size:18})," Category *"]}),e.jsxs("select",{value:f?._id||"",onChange:t=>{const a=C.find(r=>r._id===t.target.value);w(a)},required:!0,children:[e.jsx("option",{value:"",children:"Select category"}),C.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})]}),e.jsx("button",{type:"submit",className:"submit-button",disabled:S,children:S?"Submitting...":"Submit Quote Request"})]})]}),e.jsx(N,{})]})};export{J as default};
