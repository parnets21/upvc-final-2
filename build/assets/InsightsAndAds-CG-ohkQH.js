import{c as Q,u as V,b as G,r as i,j as e,e as a,d as n,a as v}from"./index-CNH5pjLZ.js";import{R as U}from"./index-BJYhKZyp.js";import{y as Y,j as b,z as W,A as $}from"./index-DJ2pV3sM.js";import{B as N}from"./BuyerBottomNav-B6lU8ncy.js";import{T as H}from"./TopTabBar-BrX66--H.js";const ae=()=>{const{buyerToken:p}=Q(),c=V(),x=G(),[S,E]=i.useState([]),[A,L]=i.useState([]),[R,y]=i.useState(!1),[f,I]=i.useState(!1),[J,P]=i.useState(!1),[w,T]=i.useState({}),[M,m]=i.useState(!1),[d,B]=i.useState(null),[u,C]=i.useState([]),[K,D]=i.useState([]),_=async()=>{try{if(y(!0),x.pathname==="/buyer/insights"){console.log("=== Fetching Buyer Advertisements ==="),console.log("API Base URL:",n("")),console.log("Full API URL:",n("api/buyer/advertisements"));const t=await v.get(n("api/buyer/advertisements"));console.log("Buyer Ads Response:",t),console.log("Buyer Ads Data:",t?.data);let l=[];t?.data&&(Array.isArray(t.data)?l=t.data:t.data.ads&&Array.isArray(t.data.ads)?l=t.data.ads:t.data.data&&Array.isArray(t.data.data)&&(l=t.data.data)),console.log("Total buyer ads found:",l.length),console.log("Ads:",l),l.forEach((o,h)=>{console.log(`Ad ${h+1} URL Construction:`,{id:o._id,title:o.title,type:o.type,originalMediaUrl:o.mediaUrl,resolvedMediaUrl:r(o.mediaUrl),originalThumbnailUrl:o.thumbnailUrl,resolvedThumbnailUrl:o.thumbnailUrl?r(o.thumbnailUrl):null})}),L(l)}else{const t=await v.get(n("api/subcategories"));E(t?.data||[])}}catch(s){I(s.message),console.error("Error fetching data:",s)}finally{y(!1),P(!1)}};i.useEffect(()=>{_()},[x.pathname]);const r=s=>{if(!s)return console.warn("resolveMediaUrl: No URL provided"),null;const t=String(s).trim().replace(/\\/g,"/");if(console.log("resolveMediaUrl - Input:",s),console.log("resolveMediaUrl - Cleaned:",t),/^https?:\/\//i.test(t))return console.log("resolveMediaUrl - Already full URL:",t),t;const l=t.startsWith("/")?t.substring(1):t;if(console.log("resolveMediaUrl - Without leading slash:",l),l.startsWith("uploads/")){const h=n(l);return console.log("resolveMediaUrl - Path has uploads/, Final URL:",h),h}const o=n(`uploads/${l}`);return console.log("resolveMediaUrl - Added uploads/ prefix, Final URL:",o),o},O=async s=>{if(!p){alert("Please login to continue");return}try{const t=await v.get(n("api/quotes"),{headers:{Authorization:`Bearer ${p}`}});if(t.data.success){const o=(t.data.quotes||[]).filter(z=>!z.isGenerated);D(o),C(o),o.length>0?c("/buyer/quote-request",{state:{selectedCategory:s}}):c("/buyer/buy-now",{state:{selectedCategory:s}})}}catch(t){console.error("Error selecting category:",t),c("/buyer/buy-now",{state:{selectedCategory:s}})}},k=()=>{m(!1),c("/buyer/buy-now",{state:{selectedCategory:d}})},j=()=>{m(!1),B(null)},F=()=>{m(!1),c("/buyer/buy-now",{state:{selectedCategory:d}})},q=()=>{m(!1),c("/buyer/quote-request",{state:{selectedCategory:d}})},g=s=>{T(t=>({...t,[s]:!t[s]}))};return R?e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"spinner"})}),e.jsx(N,{})]}):f?e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"error-container",children:e.jsxs(a,{className:"error-text",children:["Error loading data: ",f]})}),e.jsx(N,{})]}):e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"insights-ads-header",children:e.jsx("img",{src:"/logo.png",alt:"Logo",className:"insights-logo"})}),e.jsx(H,{}),e.jsx("div",{className:"insights-ads-content",children:x.pathname==="/buyer/insights"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-section",children:[e.jsx("div",{className:"insights-header-icon-wrapper",children:e.jsx(Y,{className:"insights-header-icon"})}),e.jsx(a,{weight:"Inter",className:"header-text",children:"INSIGHTS & ADVERTISEMENTS"}),e.jsx("div",{className:"insights-header-divider"}),e.jsx(a,{weight:"Inter",className:"sub-header-text",children:"Explore our latest advertisements and insights about uPVC windows. Discover new products, trends, and special offers."})]}),e.jsx("div",{className:"categories-list",children:A.map(s=>e.jsxs("div",{className:"category-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"title-container",children:e.jsxs("div",{className:"category-title-wrapper",children:[e.jsx("div",{className:"category-title-line left"}),e.jsx(a,{weight:"Inter",className:"category-title",children:s.title}),e.jsx("div",{className:"category-title-line right"})]})})}),e.jsx(a,{weight:"Inter",className:"category-description",children:s.description}),e.jsxs("div",{className:"video-container",children:[s.mediaUrl?s.type==="video"?e.jsx(U,{url:r(s.mediaUrl),controls:!0,playing:w[s._id]||!1,width:"100%",height:"100%",onPlay:()=>g(s._id),onPause:()=>g(s._id),onError:t=>{console.error("=== Advertisement Video Load Error ==="),console.error("Ad ID:",s._id),console.error("Ad Title:",s.title),console.error("Original Path:",s.mediaUrl),console.error("Resolved URL:",r(s.mediaUrl)),console.error("Error:",t),console.error("=====================================")},onReady:()=>{console.log("✓ Advertisement video ready:",{id:s._id,title:s.title,url:r(s.mediaUrl)})},config:{file:{attributes:{controlsList:"nodownload",preload:"metadata"}}}}):e.jsx("img",{src:r(s.mediaUrl),alt:s.title,className:"ad-image",style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>{console.error("Image failed to load:",{originalUrl:s.mediaUrl,resolvedUrl:r(s.mediaUrl)}),t.target.style.display="none"}}):e.jsx("div",{className:"no-video",children:e.jsx("p",{children:"No media available"})}),e.jsx("div",{className:"video-overlay"})]}),s.sponsorText&&e.jsx("div",{className:"sponsor-container",children:e.jsxs("div",{className:"sponsor-content",children:[s.sponsorLogo?e.jsx("img",{src:r(s.sponsorLogo),alt:"Sponsor",className:"sponsor-logo"}):e.jsx("img",{src:"/logo.png",alt:"Logo",className:"sponsor-logo"}),e.jsxs(a,{weight:"Inter",className:"sponsor-text",children:["SPONSORED BY ",s.sponsorText.toUpperCase()]})]})})]},s._id))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-section",children:[e.jsx(a,{weight:"Inter",className:"header-text",children:"SELECT YOUR PREFERRED CATEGORY"}),e.jsx(a,{weight:"Inter",className:"sub-header-text",children:"We've categorized uPVC windows into 3 tiers to match your style & requirements. Please select one category to explore the premium brands we offer."})]}),e.jsx("div",{className:"categories-list",children:S.map(s=>e.jsxs("div",{className:"category-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"title-container",children:e.jsxs("div",{className:"category-title-wrapper",children:[e.jsx("div",{className:"category-title-line left"}),e.jsx(a,{weight:"Inter",className:"category-title",children:s.name}),e.jsx("div",{className:"category-title-line right"})]})}),e.jsxs("button",{className:"select-button",onClick:()=>O(s),children:[e.jsx(a,{weight:"Inter",className:"select-button-text",children:"SELECT"}),e.jsx(b,{size:18,color:"#fff"})]})]}),e.jsx(a,{weight:"Inter",className:"category-description",children:s.description}),e.jsxs("div",{className:"video-container",children:[s.videoUrl?e.jsx(U,{url:r(s.videoUrl),controls:!0,playing:w[s._id]||!1,width:"100%",height:"100%",onPlay:()=>g(s._id),onPause:()=>g(s._id),onError:t=>{console.error("=== Subcategory Video Load Error ==="),console.error("Subcategory ID:",s._id),console.error("Subcategory Name:",s.name),console.error("Original Path:",s.videoUrl),console.error("Resolved URL:",r(s.videoUrl)),console.error("Error:",t),console.error("====================================")},onReady:()=>{console.log("✓ Subcategory video ready:",{id:s._id,name:s.name,url:r(s.videoUrl)})},config:{file:{attributes:{controlsList:"nodownload",preload:"metadata"}}}}):e.jsx("div",{className:"no-video",children:e.jsx("p",{children:"No video available"})}),e.jsx("div",{className:"video-overlay"})]}),e.jsx("div",{className:"sponsor-container",children:e.jsxs("div",{className:"sponsor-content",children:[s.sponsorLogo?e.jsx("img",{src:r(s.sponsorLogo),alt:"Sponsor",className:"sponsor-logo"}):e.jsx("img",{src:"/logo.png",alt:"Logo",className:"sponsor-logo"}),e.jsxs(a,{weight:"Inter",className:"sponsor-text",children:["SPONSORED BY"," ",s?.sponsorText?.toUpperCase()||"ELITE CREST"]})]})})]},s._id))})]})}),M&&d&&e.jsx("div",{className:"category-modal-overlay",onClick:j,children:e.jsxs("div",{className:"category-modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"category-modal-header",children:[e.jsx(a,{weight:"Bold",className:"category-modal-title",children:d.name}),e.jsx("button",{className:"category-modal-close",onClick:j,children:e.jsx(W,{size:24})})]}),e.jsxs("div",{className:"collections-section",children:[e.jsx(a,{weight:"SemiBold",className:"collections-title",children:"YOUR COLLECTIONS"}),u.length>0?e.jsx("div",{className:"collections-list",children:u.map((s,t)=>e.jsxs("div",{className:"collection-item",children:[e.jsxs("div",{className:"collection-item-info",children:[e.jsx(a,{weight:"Inter",className:"collection-item-name",children:s.product?.title||`Quote ${t+1}`}),e.jsxs(a,{className:"collection-item-details",children:[s.color," • ",s.installationLocation," • ",s.sqft||s.height*s.width," sqft"]})]}),e.jsx("div",{className:"collection-item-badge",children:e.jsxs(a,{weight:"SemiBold",className:"collection-item-quantity",children:[s.quantity,"x"]})})]},s._id||t))}):e.jsxs("div",{className:"collections-empty",children:[e.jsx($,{size:40,color:"#ccc"}),e.jsx(a,{className:"collections-empty-text",children:"No items in your collection yet"})]})]}),e.jsxs("div",{className:"category-modal-actions",children:[e.jsxs("div",{className:"category-modal-buttons-row",children:[e.jsx("button",{className:"category-modal-button cancel-button",onClick:j,children:e.jsx(a,{weight:"SemiBold",className:"category-modal-button-text",children:"CANCEL"})}),e.jsx("button",{className:"category-modal-button add-button",onClick:F,children:e.jsx(a,{weight:"SemiBold",className:"category-modal-button-text",children:"ADD"})})]}),e.jsx("button",{className:"category-modal-button add-more-button",onClick:k,children:e.jsx(a,{weight:"SemiBold",className:"category-modal-button-text",children:"ADD MORE"})})]}),u.length>0&&e.jsx("div",{className:"generate-lead-section",children:e.jsxs("button",{className:"generate-lead-button",onClick:q,children:[e.jsx(a,{weight:"Bold",className:"generate-lead-button-text",children:"GENERATE LEAD"}),e.jsx(b,{size:20,color:"#fff"})]})})]})}),e.jsx(N,{})]})};export{ae as default};
