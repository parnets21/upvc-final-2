import{u as V,b as k,c as I,r,a as b,A as O,j as a}from"./index-BJNj8_gr.js";const B=()=>{const i=V(),P=k(),{loginSeller:y}=I(),{mobileNumber:o,otp:T}=P.state||{},[n,c]=r.useState(["","","",""]),[j,x]=r.useState(T||""),[l,d]=r.useState(!1),[p,N]=r.useState(!1),[u,v]=r.useState(30),[$,f]=r.useState(0),m=r.useRef(!1);r.useEffect(()=>{if(u>0){const s=setTimeout(()=>v(u-1),1e3);return()=>clearTimeout(s)}else N(!0)},[u]);const w=(s,e)=>{if(e&&!/^\d$/.test(e))return;const t=[...n];if(t[s]=e,c(t),e&&s<3){const h=document.getElementById(`seller-otp-${s+1}`);h&&h.focus()}},E=(s,e)=>{if(e.key==="Backspace"&&!n[s]&&s>0){const t=document.getElementById(`seller-otp-${s-1}`);t&&t.focus()}},g=r.useCallback(async(s=n.join(""))=>{if(s.length!==4){alert("Please enter a 4-digit OTP");return}if(!(m.current||l)){m.current=!0,d(!0);try{console.log("Verifying OTP:",s,"for phone:",o);const e=await b.post(`${O}/api/sellers/verify-otp`,{phoneNumber:o,otp:s});if(console.log("Verification response:",e.data),e.data.success)if(e.data.isNewUser)i("/seller/welcome-setup",{state:{mobileNumber:o,message:e.data.message||"OTP verified successfully. Please complete registration."}});else if(e.data.token){y(e.data.token);const t=e.data.status||e.data.seller?.status;t==="pending"?i("/seller/pending-approval"):t==="approved"?i("/seller/dashboard"):t==="rejected"?(alert(e.data.seller?.rejectionReason||"Your account has been rejected. Please contact support."),i("/seller/pending-approval")):i("/seller/dashboard")}else alert(e.data.message||"OTP verified successfully"),i("/seller/welcome-setup",{state:{mobileNumber:o}});else alert(e.data.message||"OTP verification failed"),c(["","","",""]),f(t=>t+1)}catch(e){console.error("Verification error:",e);const t=e.response?.data?.message||"OTP verification failed";alert(`Error: ${t}`),c(["","","",""]),f(h=>h+1)}finally{d(!1),m.current=!1}}},[n,o,l,y,i]);r.useEffect(()=>{const s=n.join("");s.length===4&&!l&&!m.current&&g(s)},[n,g,l]);const S=async()=>{if(p)try{d(!0);const s=await b.post(`${O}/api/sellers/send-otp`,{phoneNumber:o});c(["","","",""]),f(e=>e+1),N(!1),v(30),s.data.otp&&x(s.data.otp),alert(`New OTP sent! OTP: ${s.data.otp}`)}catch(s){const e=s.response?.data?.message||"Failed to resend OTP";alert(`Error: ${e}`)}finally{d(!1)}},C=o?`+91 ******${o.slice(-3)}`:"";return a.jsxs("div",{className:"seller-otp-verification-container",children:[l&&a.jsx("div",{className:"seller-otp-loader",children:a.jsx("div",{className:"seller-otp-spinner"})}),a.jsxs("div",{className:`seller-otp-verification-content ${l?"blurred":""}`,children:[j&&a.jsxs("div",{className:"seller-otp-display",children:[a.jsx("p",{className:"seller-otp-display-label",children:"Your OTP Code:"}),a.jsx("div",{className:"seller-otp-display-code",children:j})]}),a.jsx("h2",{className:"seller-otp-title",children:"Verification code"}),a.jsx("p",{className:"seller-otp-subtitle",children:"Enter the 4-digit code sent to"}),a.jsx("p",{className:"seller-otp-phone",children:C}),a.jsx("div",{className:"seller-otp-inputs",children:n.map((s,e)=>a.jsx("input",{id:`seller-otp-${e}`,type:"text",className:`seller-otp-input ${s?"filled":""}`,maxLength:1,value:s,onChange:t=>w(e,t.target.value),onKeyDown:t=>E(e,t),disabled:l,autoFocus:e===0},e))},$),a.jsx("button",{className:"seller-otp-clear",onClick:()=>{c(["","","",""]),f(s=>s+1),document.getElementById("seller-otp-0")?.focus()},disabled:l,children:"Clear OTP"}),a.jsx("button",{className:`seller-otp-verify ${l?"disabled":""}`,onClick:()=>g(),disabled:l||n.join("").length!==4,children:l?"Verifying...":"Verify OTP"}),a.jsx("button",{className:`seller-otp-resend ${p?"":"disabled"}`,onClick:S,disabled:!p||l,children:p?"Resend OTP":`Resend in ${u}s`})]})]})};export{B as default};
