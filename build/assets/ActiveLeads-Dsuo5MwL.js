import{c as J,r,a as K,d as u,j as e,e as a}from"./index-BJNj8_gr.js";import{R as X}from"./index-BMSfizGN.js";import{m as Z,n as ee,o as se,p as te,q as ae,r as C,s as ie,t as ne,u as re,v as ce,w as le,x as oe}from"./index-DLTgG_l3.js";import{B as z}from"./BuyerBottomNav-CEiaXiD3.js";const ge=()=>{const{buyerToken:h}=J(),[g,q]=r.useState([]),[M,E]=r.useState(!0),[x,p]=r.useState(null),[N,v]=r.useState({}),[f,m]=r.useState(null),[de,k]=r.useState(!1),[F,w]=r.useState({}),[T,y]=r.useState({}),[I,S]=r.useState(new Set),A=r.useRef({});r.useEffect(()=>{h&&P()},[h]);const P=async()=>{try{if(!h)return;const s=await K.get(u("api/buyer/leads"),{headers:{Authorization:`Bearer ${h}`}});s.data.success&&(q(s.data.leads),w({}))}catch(s){console.error("Error fetching leads:",s)}finally{E(!1),k(!1)}},$=s=>{x===s?(p(null),m(null)):(p(s),N[s]||v(t=>({...t,[s]:0})))},B=s=>{if(!I.has(s)){S(t=>new Set(t).add(s));return}m(f===s?null:s)},R=s=>{if(!s)return null;let t=s.trim().replace(/\\/g,"/");return t.startsWith("http://")||t.startsWith("https://")?t:u(t)},U=s=>{if(!s)return null;let t=s.trim().replace(/\\/g,"/");return t.startsWith("http://")||t.startsWith("https://")?t:u(t)},D=s=>{window.open(`tel:${s}`,"_self")},W=s=>{window.open(`https://wa.me/${s.replace(/[^0-9]/g,"")}`,"_blank")},O=s=>{s&&window.open(s,"_blank")},b=s=>{let t=0;return s.forEach(l=>{if(l.size){const i=l.size.match(/(\d+(?:\.\d+)?)ft\s*x\s*(\d+(?:\.\d+)?)ft/i);if(i){const c=parseFloat(i[1]),o=parseFloat(i[2]);t+=c*o*(l.quantity||1)}}}),t},L=s=>{if(!s)return"";const t=s.match(/(\d+(?:\.\d+)?)ft\s*x\s*(\d+(?:\.\d+)?)ft/i);if(t){const l=parseFloat(t[1]),i=parseFloat(t[2]);return l*i+" sq ft"}return s},_=(s,t,l)=>{const i=`${t}-${s.id}`,c=f===i,o=R(s.video),j=F[i],Y=T[i],G=I.has(i)&&x===t&&o&&!j,V=U(s.visitingCard);return e.jsxs("div",{className:"seller-card",children:[e.jsx("div",{className:"seller-header",children:e.jsx(a,{weight:"Inter",className:"brand-name",children:s.brandName})}),o?e.jsx("div",{className:"video-container",onClick:()=>B(i),children:G&&!j?e.jsxs(e.Fragment,{children:[e.jsx(X,{ref:n=>A.current[i]=n,url:o,playing:c,controls:!0,width:"100%",height:"100%",onError:()=>w(n=>({...n,[i]:!0})),onReady:()=>{y(n=>({...n,[i]:!1})),S(n=>new Set(n).add(i))},onBuffer:()=>y(n=>({...n,[i]:!0}))}),Y&&e.jsxs("div",{className:"video-loading-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx(a,{weight:"Inter",className:"video-loading-text",children:"Loading video..."})]})]}):j?e.jsxs("div",{className:"video-error-container",children:[e.jsx(se,{size:50,color:"#ff4444"}),e.jsx(a,{weight:"Inter",className:"video-error-text",children:"Video unavailable"})]}):e.jsxs("div",{className:"video-placeholder-container",children:[e.jsx(te,{size:60,color:"rgba(255,255,255,0.8)"}),e.jsx(a,{weight:"Inter",className:"video-placeholder-text",children:"Tap to load video"})]})}):e.jsxs("div",{className:"no-video-container",children:[e.jsx(ae,{size:60,color:"#ccc"}),e.jsx(a,{weight:"Inter",className:"no-video-text",children:"No video available"})]}),e.jsxs("div",{className:"seller-details",children:[e.jsx(d,{icon:e.jsx(C,{}),text:s.name}),e.jsxs("button",{className:"detail-row",onClick:()=>D(s.contactNo),children:[e.jsx(ie,{size:18,color:"#555"}),e.jsx(a,{weight:"Inter",className:"detail-text",children:s.contactNo})]}),e.jsxs("button",{className:"detail-row",onClick:()=>W(s.whatsapp),children:[e.jsx(ne,{size:18,color:"#555"}),e.jsx(a,{weight:"Inter",className:"detail-text",children:s.whatsapp})]}),e.jsx(d,{icon:e.jsx(re,{}),text:s.address}),e.jsx(d,{icon:e.jsx(ce,{}),text:`${s.yearsInBusiness} years in business`}),e.jsx(d,{icon:e.jsx(le,{}),text:`Capacity: ${s.manuCap}`}),e.jsx(d,{icon:e.jsx(C,{}),text:`Team: ${s.teamSize}`}),e.jsxs("div",{className:"quotes-container",children:[e.jsx(a,{weight:"Inter",className:"section-title",children:"Your Selections"}),e.jsx(a,{weight:"Inter",className:"quote-detail total",children:e.jsxs("strong",{children:["Total: ",b(s.quotes)," sq ft"]})}),s.quotes.map((n,H)=>e.jsxs("div",{className:"quote-item",children:[e.jsxs(a,{weight:"Inter",className:"quote-title",children:[n.productTitle," (",n.color,")"]}),e.jsxs(a,{weight:"Inter",className:"quote-detail",children:["Size: ",L(n.size)," | Qty: ",n.quantity]})]},H))]})]}),e.jsxs("div",{className:"pdf-card",children:[e.jsx(oe,{size:40,color:"#fff"}),e.jsx(a,{weight:"Inter",className:"pdf-title",children:V?"View Visiting Card":"Dummy Visiting Card"}),e.jsx("button",{className:"open-button",onClick:()=>O(V),children:e.jsx(a,{weight:"Inter",className:"open-button-text",children:"Open PDF"})})]})]},s.id)},d=({icon:s,text:t})=>e.jsxs("div",{className:"detail-row",children:[s,e.jsx(a,{weight:"Inter",className:"detail-text",children:t})]}),Q=s=>{const t=N[s.id]||0,l=s.sellers&&s.sellers.length>1;return e.jsxs("div",{className:"lead-card",children:[e.jsx("button",{className:"lead-header-button",onClick:()=>$(s.id),children:e.jsxs("div",{className:"lead-header",children:[e.jsxs("div",{className:"lead-header-content",children:[e.jsx(a,{weight:"Inter",className:"lead-date",children:s.date}),e.jsx(a,{weight:"Inter",className:"lead-project",children:s.projectName}),e.jsx(a,{weight:"Inter",className:"lead-address",children:s.projectAddress}),e.jsxs("div",{className:"project-meta",children:[e.jsxs(a,{weight:"Inter",className:"meta-text",children:["Stage: ",s.projectStage]}),e.jsxs(a,{weight:"Inter",className:"meta-text",children:["Timeline: ",s.projectTimeline]})]}),e.jsx(a,{weight:"Inter",className:"lead-category",children:s.category})]}),x===s.id?e.jsx(Z,{size:24,color:"#000"}):e.jsx(ee,{size:24,color:"#000"})]})}),x===s.id&&e.jsx("div",{className:"sellers-container",children:s.sellers&&s.sellers.length===0?e.jsxs("div",{className:"no-sellers",children:[e.jsx(a,{weight:"Inter",className:"no-sellers-text",children:"No seller responses yet. Please check back later!"}),e.jsxs("div",{className:"quotes-container",children:[e.jsx(a,{weight:"Inter",className:"section-title",children:"Your Selections"}),e.jsx(a,{weight:"Inter",className:"quote-detail total",children:e.jsxs("strong",{children:["Total: ",b(s.quotes)," sq ft"]})}),s.quotes?.map((i,c)=>e.jsxs("div",{className:"quote-item",children:[e.jsxs(a,{weight:"Inter",className:"quote-title",children:[i.productTitle," (",i.color,")"]}),e.jsxs(a,{weight:"Inter",className:"quote-detail",children:["Size: ",L(i.size)," | Qty: ",i.quantity]})]},c))]})]}):e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"seller-dots",children:s.sellers.map((i,c)=>e.jsx("button",{className:`dot ${c===t?"active":""}`,onClick:()=>v(o=>({...o,[s.id]:c}))},c))}),e.jsx("div",{className:"sellers-carousel",children:s.sellers&&s.sellers.length>0&&e.jsx("div",{className:"seller-item-wrapper",children:_(s.sellers[t],s.id)})})]})})]},s.id)};return M?e.jsxs("div",{className:"active-leads-container",children:[e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"spinner"})}),e.jsx(z,{})]}):e.jsxs("div",{className:"active-leads-container",children:[e.jsx("div",{className:"active-leads-header",children:e.jsx("img",{src:"/logo.png",alt:"Logo",className:"active-leads-logo"})}),e.jsx("div",{className:"active-leads-content",children:g.length>0?e.jsx("div",{className:"leads-list",children:g.map(Q)}):e.jsx("div",{className:"empty-container",children:e.jsx(a,{weight:"Inter",className:"empty-text",children:"No leads found"})})}),e.jsx(z,{})]})};export{ge as default};
