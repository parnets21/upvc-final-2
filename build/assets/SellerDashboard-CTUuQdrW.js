import{c as A,u as $,r as o,a as y,A as U,d as w,j as e,e as r,y as t}from"./index-BJNj8_gr.js";import{R as F}from"./index-BMSfizGN.js";import{v as T,R as D,S as O,T as Y,U as P}from"./index-DLTgG_l3.js";import{S as W}from"./SellerBottomNav-r_aHJrkn.js";const J=()=>{const{sellerToken:i,logout:S}=A(),V=$(),[u,n]=o.useState(!1),[g,d]=o.useState(null),[p,m]=o.useState(!1),[v,h]=o.useState(0),[k,x]=o.useState(!0),[f,M]=o.useState(!0),[j,c]=o.useState(!1),b=o.useRef(null);o.useEffect(()=>{z()},[]);const z=async()=>{try{if(x(!0),!i){x(!1);return}const s=await y.get(`${U}/api/sellers`,{headers:{Authorization:`Bearer ${i}`}});if(s.data.success&&s.data.seller){const l=s.data.seller.status;if(l!=="approved"){console.log("Seller status is not approved:",l),V("/seller/pending-approval");return}s.data.seller.businessProfileVideo?(n(!0),d(w(s.data.seller.businessProfileVideo))):(n(!1),d(null))}}catch(s){console.error("Error checking existing video:",s),n(!1),d(null)}finally{x(!1)}},R=s=>{const l=s.target.files[0];l&&E(l)},E=async s=>{try{if(!s.type.startsWith("video/")){t.error("Please select a video file");return}const l=s.size/(1024*1024);if(l>200){t.error(`Video file is ${l.toFixed(2)}MB. Maximum allowed size is 200MB.`);return}const a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=async function(){if(window.URL.revokeObjectURL(a.src),a.duration>45){t.error("Video must be 45 seconds or less");return}await I(s)},a.src=URL.createObjectURL(s)}catch(l){console.error("Error in handleUpload:",l),t.error("Failed to process video")}},I=async s=>{try{if(m(!0),h(0),!i){t.error("Please login"),m(!1);return}const l=new FormData;l.append("businessProfileVideo",s);const a=await y.post(`${U}/api/sellers/business-video`,l,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"multipart/form-data"},onUploadProgress:N=>{const L=Math.round(N.loaded*100/N.total);h(L)}});if(a.data.success)n(!0),d(w(a.data.videoUrl)),t.success("Video uploaded successfully!");else throw new Error(a.data.message||"Failed to upload video")}catch(l){console.error("Error uploading video:",l),t.error(l.response?.data?.message||"Failed to upload video")}finally{m(!1),h(0)}},B=()=>{b.current?.click()},C=()=>{M(!f)};return k?e.jsx("div",{className:"seller-dashboard-container",children:e.jsxs("div",{className:"seller-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx(r,{children:"Loading..."})]})}):e.jsxs("div",{className:"seller-dashboard-container",children:[e.jsxs("div",{className:"seller-dashboard-header",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"seller-logo"}),e.jsx("button",{className:"seller-logout-button",onClick:S,children:"Logout"})]}),e.jsxs("div",{className:"seller-dashboard-content",children:[e.jsxs("div",{className:"seller-welcome-section",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-black/5",children:e.jsx(T,{size:32,className:"text-black"})}),e.jsx(r,{weight:"Inter",className:"text-2xl font-bold text-black",children:"Welcome to Your Business Profile"})]}),e.jsx("div",{className:"text-center",children:e.jsx(r,{weight:"Inter",className:"text-sm text-gray-600",children:u?"Your business profile video is live! You can update it anytime.":"Upload a video to showcase your business to potential buyers"})})]}),e.jsx("div",{className:"seller-video-section",children:u&&g?e.jsxs("div",{className:"seller-video-container",children:[e.jsx("div",{className:"seller-video-player",children:e.jsx(F,{url:g,controls:!0,playing:j,muted:f,width:"100%",height:"100%",onPlay:()=>c(!0),onPause:()=>c(!1),onEnded:()=>c(!1)})}),e.jsxs("div",{className:"seller-video-controls",children:[e.jsx("button",{className:"seller-control-button",onClick:C,children:f?e.jsx(D,{size:24}):e.jsx(O,{size:24})}),e.jsx("button",{className:"seller-control-button",onClick:()=>c(!j),children:e.jsx(Y,{size:24})})]})]}):e.jsxs("div",{className:"seller-upload-placeholder",children:[e.jsx(P,{size:64,color:"#ccc"}),e.jsx(r,{weight:"Inter",className:"seller-upload-text",children:"No video uploaded yet"})]})}),e.jsxs("div",{className:"seller-upload-section",children:[e.jsx("input",{ref:b,type:"file",accept:"video/*",onChange:R,style:{display:"none"}}),e.jsxs("button",{className:"seller-upload-button",onClick:B,disabled:p,children:[e.jsx(P,{size:24}),e.jsx(r,{weight:"Inter",className:"seller-upload-button-text",children:p?`Uploading... ${v}%`:u?"Reupload Video":"Upload Video"})]}),p&&e.jsx("div",{className:"seller-progress-bar",children:e.jsx("div",{className:"seller-progress-fill",style:{width:`${v}%`}})})]})]}),e.jsx(W,{})]})};export{J as default};
