import{c as R,r as l,A as d,a as x,j as e,e as r,d as h}from"./index-BJNj8_gr.js";import{R as I}from"./index-BMSfizGN.js";import{R as U,S as L,W as M,X as T,Y as z}from"./index-DLTgG_l3.js";import{S as b}from"./SellerBottomNav-r_aHJrkn.js";const P=()=>{const{sellerToken:n}=R(),[i,m]=l.useState("featured"),[g,p]=l.useState([]),[f,j]=l.useState(!0),[o,u]=l.useState(!1),[c,k]=l.useState(null),[N,$]=l.useState({});l.useEffect(()=>{v()},[i]);const v=async()=>{try{if(!n){console.log("No seller token found"),alert("Please Login"),j(!1),u(!1);return}let s=`${d}/api/advertisements`;i!=="featured"&&(s=`${d}/api/advertisements/${i}`),console.log("Fetching ads from:",s);const t=await x.get(s,{headers:{Authorization:`Bearer ${n}`}});console.log("Ads response:",t.data);const a=await x.get(`${d}/api/sellers`,{headers:{Authorization:`Bearer ${n}`}});console.log("Seller response:",a.data),k(a.data.seller._id),p(t.data.ads||[])}catch(s){console.error("Error fetching ads:",s),console.error("Error response:",s.response?.data),alert(`Failed to fetch advertisements: ${s.response?.data?.message||s.message}`)}finally{j(!1),u(!1)}},S=()=>{u(!0),v()},y=async s=>{try{const t=await x.post(`${d}/api/advertisements/${s}/like`,{userId:c},{headers:{Authorization:`Bearer ${n}`}});p(g.map(a=>a._id===s?{...a,likes:t.data.likes,likedBy:t.data.isLiked?[...a.likedBy,c]:a.likedBy.filter(E=>E!==c)}:a))}catch(t){alert("Failed to like the post"),console.error("Error toggling like:",t)}},w=async s=>{try{const t=s.mediaUrl?h(`uploads/${s.mediaUrl}`):"",a=`${s.title}

${s.description}${t?`

Check this out: ${t}`:""}`;navigator.share?await navigator.share({title:s.title,text:a,url:t}):(await navigator.clipboard.writeText(a),alert("Link copied to clipboard!"))}catch(t){console.error("Error sharing ad:",t),t.name!=="AbortError"&&alert("Failed to share the post")}},A=s=>{$(t=>({...t,[s]:{...t[s],isMuted:!t[s]?.isMuted}}))},B=s=>e.jsxs("div",{className:"post-container",children:[e.jsx("div",{className:"post-header",children:e.jsx(r,{weight:"Inter",className:"post-title",children:s.title})}),s.type==="video"?e.jsxs("div",{className:"video-container",children:[e.jsx(I,{url:h(`uploads/${s.mediaUrl}`),className:"video-player",width:"100%",height:"100%",controls:!0,muted:N[s._id]?.isMuted??!1,playing:!1,light:s.thumbnailUrl?h(`uploads/${s.thumbnailUrl}`):!1,config:{file:{attributes:{controlsList:"nodownload"}}}}),e.jsx("button",{className:"mute-button",onClick:()=>A(s._id),children:N[s._id]?.isMuted?e.jsx(U,{size:20,color:"#fff"}):e.jsx(L,{size:20,color:"#fff"})})]}):s.type==="image"?e.jsx("img",{src:h(`uploads/${s.mediaUrl}`),alt:s.title,className:"post-image"}):e.jsx("div",{className:"post-image empty-media",children:e.jsx(r,{weight:"Inter",className:"empty-text",children:"No media available"})}),e.jsx(r,{weight:"Inter",className:"post-description",children:s.description}),e.jsxs("div",{className:"post-footer",children:[e.jsxs("button",{className:"action-button",onClick:()=>y(s._id),children:[s.likedBy?.includes(c)?e.jsx(M,{size:24,color:"red"}):e.jsx(T,{size:24,color:"black"}),e.jsx(r,{weight:"Inter",className:"action-text",children:s.likes})]}),e.jsxs("button",{className:"action-button",onClick:()=>w(s),children:[e.jsx(z,{size:22,color:"black"}),e.jsx(r,{weight:"Inter",className:"action-text",children:"Share"})]})]})]},s._id);return f&&!o?e.jsxs("div",{className:"market-insights-container",children:[e.jsxs("div",{className:"insights-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx(r,{children:"Loading..."})]}),e.jsx(b,{})]}):e.jsxs("div",{className:"market-insights-container",children:[e.jsxs("div",{className:"insights-content",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"insights-logo"}),e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${i==="featured"?"active":""}`,onClick:()=>m("featured"),children:e.jsx(r,{weight:"SemiBold",className:`tab-text ${i==="featured"?"active":""}`,children:"FEATURED"})}),e.jsx("button",{className:`tab ${i==="latest"?"active":""}`,onClick:()=>m("latest"),children:e.jsx(r,{weight:"SemiBold",className:`tab-text ${i==="latest"?"active":""}`,children:"LATEST"})}),e.jsx("button",{className:`tab ${i==="trending"?"active":""}`,onClick:()=>m("trending"),children:e.jsx(r,{weight:"SemiBold",className:`tab-text ${i==="trending"?"active":""}`,children:"TRENDING"})})]}),e.jsxs("div",{className:"list-content",children:[o&&e.jsx("div",{className:"refresh-indicator",children:e.jsx("div",{className:"spinner small"})}),g.length>0?g.map(s=>B(s)):e.jsx("div",{className:"empty-container",children:e.jsx(r,{weight:"Inter",className:"empty-text",children:o?"Refreshing...":"No advertisements found"})})]}),!f&&e.jsx("button",{className:"refresh-button",onClick:S,disabled:o,children:e.jsx(r,{weight:"Inter",children:o?"Refreshing...":"Refresh"})})]}),e.jsx(b,{})]})};export{P as default};
